(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[250],{3153:function(e,t,r){Promise.resolve().then(r.bind(r,7112))},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7112:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),i=r(9376),a=r(7775),s=r(2582);function l(){let e=(0,i.useRouter)(),{clockStatus:t,activePart:r}=(0,a.q)(),{isAdmin:l}=(0,s.a)();return(0,n.jsxs)("div",{children:["out"===t&&(0,n.jsx)("button",{onClick:()=>e.push("/time"),style:{width:"100%",padding:"12px 16px",borderRadius:"10px",marginBottom:"12px",background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.25)",color:"#fbbf24",fontSize:"13px",fontWeight:700,cursor:"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:"8px"},children:"⏰ Not clocked in — tap to start your day"}),r&&(0,n.jsx)("div",{style:{background:"linear-gradient(135deg, rgba(59,130,246,0.10), rgba(59,130,246,0.03))",border:"1px solid rgba(59,130,246,0.25)",borderRadius:"14px",padding:"14px",marginBottom:"12px"},children:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"10px",color:"#60a5fa",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px"},children:"Active Part Number"}),(0,n.jsx)("div",{style:{fontWeight:800,fontSize:"18px",marginTop:"2px"},children:r.part_number}),(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#8899aa",marginTop:"1px"},children:[r.end_customer," • ",r.graphic_package]}),(0,n.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"1px"},children:[r.vehicle_type," • ",r.customer]})]}),(0,n.jsx)("button",{onClick:()=>e.push("/select-part"),style:{background:"rgba(255,255,255,0.05)",border:"1px solid #1e2d3d",borderRadius:"8px",color:"#6b7a8d",padding:"4px 10px",fontSize:"10px",fontWeight:700},children:"Change"})]})}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,n.jsx)(o,{icon:"\uD83D\uDCF7",title:"Scan VIN",sub:r?"".concat(r.part_number," — ").concat(r.end_customer):"Select a part number first",onClick:()=>e.push("/scan"),primary:!0,disabled:!r}),(0,n.jsx)(o,{icon:"\uD83D\uDD27",title:"Set Active Part Number",sub:r?"Change what you're installing":"Choose before scanning",onClick:()=>e.push("/select-part"),highlight:!r})]})]})}function o(e){let{icon:t,title:r,sub:i,onClick:a,primary:s,highlight:l,disabled:o}=e;return(0,n.jsxs)("button",{onClick:o?void 0:a,style:{display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"12px",borderRadius:"10px",cursor:o?"default":"pointer",textAlign:"left",border:s?"1px solid rgba(59,130,246,0.3)":l?"1px solid rgba(245,158,11,0.3)":"1px solid #1e2d3d",background:s?"rgba(59,130,246,0.05)":l?"rgba(245,158,11,0.03)":"#141e2b",color:"#e8ecf1",opacity:o?.4:1},children:[(0,n.jsx)("div",{style:{width:"38px",height:"38px",borderRadius:"8px",background:s?"rgba(59,130,246,0.1)":"rgba(255,255,255,0.03)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"17px",flexShrink:0},children:t}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:700,fontSize:"14px"},children:r}),i&&(0,n.jsx)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"1px"},children:i})]})]})}},7775:function(e,t,r){"use strict";r.d(t,{q:function(){return u},w:function(){return o}});var n=r(7437),i=r(2265),a=r(4754),s=r(2582);let l=(0,i.createContext)({});function o(e){let{children:t}=e,{user:r}=(0,s.a)(),o=(0,a.e)(),[u,d]=(0,i.useState)("out"),[c,f]=(0,i.useState)(null),[p,b]=(0,i.useState)(null),[m,g]=(0,i.useState)([]),[x,h]=(0,i.useState)(0),[_,k]=(0,i.useState)(null),[S,y]=(0,i.useState)(null),[v,w]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(!r){w(!1);return}(async()=>{try{let{data:e}=await o.from("time_entries").select("*").eq("user_id",r.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(e){k(e),f(e.clock_in);let{data:t}=await o.from("time_breaks").select("*").eq("time_entry_id",e.id).order("break_start",{ascending:!0}),r=t||[];g(r);let n=r.find(e=>!e.break_end);n?(b(n.break_start),d("break")):d("in")}}catch(e){console.error("AppProvider load error:",e)}w(!1)})()},[r]),(0,i.useEffect)(()=>{if("out"===u||!c)return;let e=setInterval(()=>{let e=Date.now()-new Date(c).getTime();m.forEach(t=>{t.break_end&&(e-=new Date(t.break_end).getTime()-new Date(t.break_start).getTime())}),"break"===u&&p&&(e-=Date.now()-new Date(p).getTime()),h(Math.max(0,e))},1e3);return()=>clearInterval(e)},[u,c,p,m]);let C=(0,i.useCallback)(async()=>{if(!r)return;let e=new Date().toISOString(),{data:t,error:n}=await o.from("time_entries").insert({user_id:r.id,clock_in:e,status:"clocked_in"}).select().single();t&&!n&&(k(t),f(e),g([]),d("in"),h(0))},[r,o]),j=(0,i.useCallback)(async()=>{if(!_)return;let e=new Date().toISOString(),{data:t}=await o.from("time_breaks").insert({time_entry_id:_.id,break_start:e}).select().single();await o.from("time_entries").update({status:"on_break"}).eq("id",_.id),t&&(g(e=>[...e,t]),b(e),d("break"))},[_,o]),D=(0,i.useCallback)(async()=>{if(!_||!p)return;let e=new Date().toISOString(),t=m.find(e=>!e.break_end);t&&(await o.from("time_breaks").update({break_end:e}).eq("id",t.id),g(r=>r.map(r=>r.id===t.id?{...r,break_end:e}:r))),await o.from("time_entries").update({status:"clocked_in"}).eq("id",_.id),b(null),d("in")},[_,p,m,o]),P=(0,i.useCallback)(async()=>{if(!_||!c)return;let e=new Date,t=e.toISOString(),r=m.find(e=>!e.break_end);r&&await o.from("time_breaks").update({break_end:t}).eq("id",r.id);let n=e.getTime()-new Date(c).getTime();m.map(e=>({...e,break_end:e.break_end||t})).forEach(e=>{n-=new Date(e.break_end).getTime()-new Date(e.break_start).getTime()}),await o.from("time_entries").update({clock_out:t,status:"clocked_out",total_ms:Math.max(0,n)}).eq("id",_.id),d("out"),f(null),b(null),g([]),h(0),k(null)},[_,c,m,o]);return(0,n.jsx)(l.Provider,{value:{clockStatus:u,clockInTime:c,breakStartTime:p,currentBreaks:m,elapsed:x,activeTimeEntry:_,doClockIn:C,doStartBreak:j,doEndBreak:D,doClockOut:P,activePart:S,setActivePart:y,appLoading:v},children:t})}let u=()=>(0,i.useContext)(l)},2582:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return o}});var n=r(7437),i=r(2265),a=r(4754);let s=(0,i.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function l(e){let{children:t}=e,[r,l]=(0,i.useState)(null),[o,u]=(0,i.useState)(null),[d,c]=(0,i.useState)(!0),f=(0,a.e)();(0,i.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:r}}=await f.auth.getSession(),n=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;if(e)return;if(l(n),n){let{data:t}=await f.from("profiles").select("*").eq("id",n.id).maybeSingle();e||u(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||c(!1)})();let{data:{subscription:t}}=f.auth.onAuthStateChange(async(t,r)=>{try{var n;if(e)return;if(l(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),null==r?void 0:r.user){let{data:t}=await f.from("profiles").select("*").eq("id",r.user.id).maybeSingle();e||u(t)}else u(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||c(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let p=async()=>{await f.auth.signOut(),l(null),u(null)};return(0,n.jsx)(s.Provider,{value:{user:r,profile:o,isAdmin:(null==o?void 0:o.role)==="admin",loading:d,signOut:p},children:t})}let o=()=>(0,i.useContext)(s)},4754:function(e,t,r){"use strict";r.d(t,{e:function(){return a}});var n=r(4033),i=r(257);function a(){return(0,n.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=3153)}),_N_E=e.O()}]);