(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{6437:function(e,t,n){Promise.resolve().then(n.bind(n,4959))},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},4959:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),i=n(2265),o=n(9376),a=n(4754);function c(){let e=(0,o.useRouter)(),t=(0,a.e)(),[c,s]=(0,i.useState)([]),[d,l]=(0,i.useState)(!0),[u,p]=(0,i.useState)(!1),[h,x]=(0,i.useState)(!1),[f,g]=(0,i.useState)(0),[m,v]=(0,i.useState)("pending"),[b,w]=(0,i.useState)([]),[_,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{S()},[]);var S=async()=>{l(!0);var{data:e}=await t.from("scanned_vehicles").select("*").is("exported_at",null).order("scanned_at",{ascending:!1});s(e||[]),l(!1)},j=async()=>{y(!0);var{data:e}=await t.from("scanned_vehicles").select("*").not("exported_at","is",null).order("exported_at",{ascending:!1});w(e||[]),y(!1)},k=e=>{v(e),"archive"===e&&j()},E={};c.forEach(function(e){var t=e.customer||"No Customer";E[t]||(E[t]=[]),E[t].push(e)});var P=async()=>{if(0!==c.length){p(!0);try{var e=await Promise.all([n.e(425),n.e(919)]).then(n.bind(n,2093)),r=new Date,i=window.location.origin,o=c.map(function(e){var t=new Date(e.scanned_at);return{VIN:e.vin,"Part Number":e.part_number||"",Customer:e.customer||"","End Customer":e.end_customer||"",Year:e.vehicle_year||"",Make:e.vehicle_make||"",Model:e.vehicle_model||"","Date Scanned":t.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),Photos:i+"/view/"+e.id}}),a=e.utils.json_to_sheet(o);a["!cols"]=[{wch:20},{wch:16},{wch:16},{wch:18},{wch:6},{wch:14},{wch:16},{wch:12},{wch:40}];var d=e.utils.book_new();e.utils.book_append_sheet(d,a,"Vehicles");var l=r.toISOString().slice(0,10);e.writeFile(d,"BMG-Export-"+l+".xlsx");var u=c.map(function(e){return e.id});await t.from("scanned_vehicles").update({exported_at:r.toISOString()}).in("id",u),g(c.length),x(!0),s([])}catch(e){console.error("Export error:",e)}p(!1)}},C=async e=>{var r=E[e];if(r&&0!==r.length){p(!0);try{var i=await Promise.all([n.e(425),n.e(919)]).then(n.bind(n,2093)),o=new Date,a=window.location.origin,c=r.map(function(e){var t=new Date(e.scanned_at);return{VIN:e.vin,"Part Number":e.part_number||"",Customer:e.customer||"","End Customer":e.end_customer||"",Year:e.vehicle_year||"",Make:e.vehicle_make||"",Model:e.vehicle_model||"","Date Scanned":t.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),Photos:a+"/view/"+e.id}}),d=i.utils.json_to_sheet(c);d["!cols"]=[{wch:20},{wch:16},{wch:16},{wch:18},{wch:6},{wch:14},{wch:16},{wch:12},{wch:40}];var l=i.utils.book_new();i.utils.book_append_sheet(l,d,"Vehicles");var u=e.replace(/[^a-zA-Z0-9]/g,"_"),h=o.toISOString().slice(0,10);i.writeFile(l,"BMG-"+u+"-"+h+".xlsx");var f=r.map(function(e){return e.id});await t.from("scanned_vehicles").update({exported_at:o.toISOString()}).in("id",f),s(function(e){return e.filter(function(e){return!f.includes(e.id)})}),g(r.length),x(!0),setTimeout(function(){x(!1)},3e3)}catch(e){console.error("Export error:",e)}p(!1)}},z=async e=>{try{var t=await Promise.all([n.e(425),n.e(919)]).then(n.bind(n,2093)),r=b.filter(function(t){return t.exported_at&&t.exported_at.slice(0,19)===e.slice(0,19)});if(0===r.length)return;var i=window.location.origin,o=r.map(function(e){var t=new Date(e.scanned_at);return{VIN:e.vin,"Part Number":e.part_number||"",Customer:e.customer||"","End Customer":e.end_customer||"",Year:e.vehicle_year||"",Make:e.vehicle_make||"",Model:e.vehicle_model||"","Date Scanned":t.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}),Photos:i+"/view/"+e.id}}),a=t.utils.json_to_sheet(o);a["!cols"]=[{wch:20},{wch:16},{wch:16},{wch:18},{wch:6},{wch:14},{wch:16},{wch:12},{wch:40}];var c=t.utils.book_new();t.utils.book_append_sheet(c,a,"Vehicles");var s=new Date(e).toISOString().slice(0,10);t.writeFile(c,"BMG-Export-"+s+".xlsx")}catch(e){console.error("Re-download error:",e)}},B={};return(b.forEach(function(e){var t,n=(null===(t=e.exported_at)||void 0===t?void 0:t.slice(0,19))||"unknown";B[n]||(B[n]=[]),B[n].push(e)}),d)?(0,r.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading..."}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"Reports"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"4px",marginBottom:"12px",background:"#141e2b",borderRadius:"8px",padding:"3px"},children:[(0,r.jsxs)("button",{onClick:function(){k("pending")},style:{flex:1,padding:"8px",borderRadius:"6px",fontSize:"12px",fontWeight:700,background:"pending"===m?"rgba(59,130,246,0.15)":"transparent",border:"none",color:"pending"===m?"#60a5fa":"#4a5f78"},children:["Ready to Export ",c.length>0?"("+c.length+")":""]}),(0,r.jsx)("button",{onClick:function(){k("archive")},style:{flex:1,padding:"8px",borderRadius:"6px",fontSize:"12px",fontWeight:700,background:"archive"===m?"rgba(59,130,246,0.15)":"transparent",border:"none",color:"archive"===m?"#60a5fa":"#4a5f78"},children:"Archive"})]}),h&&(0,r.jsxs)("div",{style:{padding:"10px 12px",background:"rgba(34,197,94,0.06)",border:"1px solid rgba(34,197,94,0.2)",borderRadius:"8px",color:"#4ade80",fontSize:"13px",fontWeight:700,marginBottom:"12px",textAlign:"center"},children:["Exported ",f," vehicles"]}),"pending"===m&&(0,r.jsxs)("div",{children:[0===c.length&&!h&&(0,r.jsxs)("div",{style:{textAlign:"center",padding:"32px 0",color:"#4a5f78"},children:[(0,r.jsx)("div",{style:{fontSize:"36px",marginBottom:"6px",opacity:.4},children:"✓"}),(0,r.jsx)("div",{style:{fontWeight:600,fontSize:"13px"},children:"All caught up - nothing to export"})]}),c.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:P,disabled:u,style:{width:"100%",padding:"14px",borderRadius:"10px",background:"#22c55e",color:"#fff",fontSize:"15px",fontWeight:800,border:"none",marginBottom:"12px"},children:u?"Exporting...":"Export All ("+c.length+" vehicles)"}),Object.keys(E).map(function(e){var t=E[e];return(0,r.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"12px",marginBottom:"8px"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:800,fontSize:"14px"},children:e}),(0,r.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"1px"},children:[t.length," vehicle",1!==t.length?"s":""]})]}),(0,r.jsx)("button",{onClick:function(){C(e)},disabled:u,style:{padding:"8px 14px",borderRadius:"8px",background:"#3b82f6",color:"#fff",fontSize:"12px",fontWeight:700,border:"none"},children:"Export"})]}),t.slice(0,5).map(function(e){var t=[e.vehicle_year,e.vehicle_make,e.vehicle_model].filter(Boolean).join(" ")||"Unknown";return(0,r.jsxs)("div",{style:{padding:"4px 0",fontSize:"11px",borderTop:"1px solid rgba(30,45,61,0.5)"},children:[(0,r.jsx)("span",{style:{fontWeight:600,color:"#e8ecf1"},children:t}),(0,r.jsx)("span",{style:{color:"#4a5f78",marginLeft:"6px",fontFamily:"monospace",fontSize:"10px"},children:e.vin}),e.part_number&&(0,r.jsx)("span",{style:{color:"#93c5fd",marginLeft:"6px",fontSize:"10px"},children:e.part_number})]},e.id)}),t.length>5&&(0,r.jsxs)("div",{style:{fontSize:"10px",color:"#4a5f78",marginTop:"4px"},children:["+ ",t.length-5," more"]})]},e)})]})]}),"archive"===m&&(0,r.jsx)("div",{children:_?(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"#4a5f78"},children:"Loading archive..."}):0===Object.keys(B).length?(0,r.jsxs)("div",{style:{textAlign:"center",padding:"32px 0",color:"#4a5f78"},children:[(0,r.jsx)("div",{style:{fontSize:"36px",marginBottom:"6px",opacity:.4},children:"\uD83D\uDCC1"}),(0,r.jsx)("div",{style:{fontWeight:600,fontSize:"13px"},children:"No exports yet"})]}):Object.keys(B).map(function(e){var t=B[e],n=new Date(e),i=Array.from(new Set(t.map(function(e){return e.customer||"Unknown"})));return(0,r.jsx)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"12px",marginBottom:"8px"},children:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{fontWeight:700,fontSize:"13px"},children:[n.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})," at ",n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,r.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"2px"},children:[t.length," vehicles — ",i.join(", ")]})]}),(0,r.jsx)("button",{onClick:function(){z(e)},style:{padding:"8px 14px",borderRadius:"8px",background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.25)",color:"#60a5fa",fontSize:"12px",fontWeight:700},children:"Re-download"})]})},e)})}),(0,r.jsx)("button",{onClick:function(){e.push("/more")},style:{width:"100%",padding:"10px",borderRadius:"10px",marginTop:"12px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"Back"})]})}},4754:function(e,t,n){"use strict";n.d(t,{e:function(){return o}});var r=n(4033),i=n(257);function o(){return(0,r.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=6437)}),_N_E=e.O()}]);