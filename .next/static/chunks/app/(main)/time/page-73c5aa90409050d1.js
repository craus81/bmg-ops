(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{1082:function(e,t,n){Promise.resolve().then(n.bind(n,6299))},6299:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var i=n(7437),r=n(2265),a=n(7775),l=n(2582),o=n(4754);function s(e){return"".concat(Math.floor(e/36e5),"h ").concat(Math.floor(e%36e5/6e4).toString().padStart(2,"0"),"m")}function d(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function c(){let[e,t]=(0,r.useState)("clock");return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{display:"flex",gap:"6px",marginBottom:"16px"},children:[{id:"clock",label:"Clock"},{id:"history",label:"History"},{id:"week",label:"Week"}].map(n=>(0,i.jsx)("button",{onClick:()=>t(n.id),style:{flex:1,padding:"8px",borderRadius:"8px",fontSize:"12px",fontWeight:700,background:e===n.id?"rgba(59,130,246,0.12)":"transparent",border:e===n.id?"1px solid rgba(59,130,246,0.3)":"1px solid #1e2d3d",color:e===n.id?"#60a5fa":"#4a5f78"},children:n.label},n.id))}),"clock"===e&&(0,i.jsx)(u,{}),"history"===e&&(0,i.jsx)(x,{}),"week"===e&&(0,i.jsx)(f,{})]})}function u(){let{clockStatus:e,elapsed:t,clockInTime:n,breakStartTime:r,currentBreaks:l,doClockIn:o,doStartBreak:c,doEndBreak:u,doClockOut:x}=(0,a.q)();return(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:"140px",height:"140px",borderRadius:"50%",margin:"10px auto 20px",background:"out"===e?"rgba(255,255,255,0.03)":"break"===e?"rgba(245,158,11,0.08)":"rgba(34,197,94,0.08)",border:"3px solid ".concat("out"===e?"#1e2d3d":"break"===e?"rgba(245,158,11,0.3)":"rgba(34,197,94,0.3)"),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:"out"===e?(0,i.jsx)("div",{style:{fontSize:"13px",color:"#4a5f78",fontWeight:600},children:"Off the Clock"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{fontSize:"10px",color:"break"===e?"#fbbf24":"#4ade80",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px"},children:"break"===e?"On Break":"Working"}),(0,i.jsx)("div",{style:{fontSize:"28px",fontWeight:800,color:"#e8ecf1",marginTop:"2px",fontVariantNumeric:"tabular-nums"},children:s(t)}),n&&(0,i.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"2px"},children:["since ",d(new Date(n))]})]})}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px",maxWidth:"320px",margin:"0 auto"},children:["out"===e&&(0,i.jsx)("button",{onClick:o,style:{...g("#22c55e"),padding:"20px",fontSize:"18px"},children:"\uD83D\uDFE2 Clock In"}),"in"===e&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:c,style:{...g("#f59e0b"),padding:"16px",fontSize:"16px"},children:"\uD83C\uDF54 Start Lunch Break"}),(0,i.jsx)("button",{onClick:x,style:{...g("#ef4444"),padding:"16px",fontSize:"16px"},children:"\uD83D\uDD34 Clock Out"})]}),"break"===e&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:u,style:{...g("#22c55e"),padding:"18px",fontSize:"17px"},children:"✅ End Break"}),r&&(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#fbbf24",marginTop:"4px"},children:["Break started at ",d(new Date(r))]})]})]}),"out"!==e&&l.filter(e=>e.break_end).length>0&&(0,i.jsxs)("div",{style:{marginTop:"20px",textAlign:"left"},children:[(0,i.jsx)("div",{style:{fontSize:"10px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"4px"},children:"Today's Breaks"}),l.filter(e=>e.break_end).map(e=>{let t=new Date(e.break_end).getTime()-new Date(e.break_start).getTime();return(0,i.jsxs)("div",{style:{fontSize:"13px",color:"#6b7a8d",padding:"4px 0"},children:[d(new Date(e.break_start))," – ",d(new Date(e.break_end)),(0,i.jsxs)("span",{style:{color:"#4a5f78"},children:[" (",s(t),")"]})]},e.id)})]})]})}function x(){let{user:e}=(0,l.a)(),[t,n]=(0,r.useState)([]),[a,c]=(0,r.useState)(!0),u=(0,o.e)();return((0,r.useEffect)(()=>{e&&(async()=>{let{data:t}=await u.from("time_entries").select("*").eq("user_id",e.id).not("clock_out","is",null).order("clock_in",{ascending:!1}).limit(14);n(t||[]),c(!1)})()},[e]),a)?(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading..."}):(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"Recent Time Entries"}),0===t.length&&(0,i.jsxs)("div",{style:{textAlign:"center",padding:"32px 0",color:"#4a5f78"},children:[(0,i.jsx)("div",{style:{fontSize:"36px",marginBottom:"6px",opacity:.4},children:"⏰"}),(0,i.jsx)("div",{style:{fontWeight:600,fontSize:"13px"},children:"No time entries yet"})]}),t.map(e=>(0,i.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"12px",marginBottom:"6px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)("div",{style:{fontWeight:700,fontSize:"14px"},children:new Date(e.clock_in).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}),(0,i.jsx)("div",{style:{fontWeight:800,fontSize:"15px",color:"#60a5fa"},children:e.total_ms?s(e.total_ms):"—"})]}),(0,i.jsxs)("div",{style:{fontSize:"12px",color:"#4a5f78",marginTop:"3px"},children:[d(new Date(e.clock_in))," – ",e.clock_out?d(new Date(e.clock_out)):"active"]})]},e.id))]})}function f(){let{user:e}=(0,l.a)(),{clockStatus:t,elapsed:n}=(0,a.q)(),[d,c]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),f=(0,o.e)();if((0,r.useEffect)(()=>{e&&(async()=>{let t=new Date,n=new Date(t);n.setDate(t.getDate()-(t.getDay()+6)%7),n.setHours(0,0,0,0);let{data:i}=await f.from("time_entries").select("*").eq("user_id",e.id).gte("clock_in",n.toISOString()).order("clock_in",{ascending:!0});c(i||[]),x(!1)})()},[e,t]),u)return(0,i.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading..."});let g=new Date,h=new Date(g);h.setDate(g.getDate()-(g.getDay()+6)%7),h.setHours(0,0,0,0);let m=Array.from({length:7},(e,i)=>{let r=new Date(h);r.setDate(h.getDate()+i);let a=d.filter(e=>new Date(e.clock_in).toDateString()===r.toDateString()).reduce((e,t)=>e+(t.total_ms||0),0);return r.toDateString()===g.toDateString()&&"out"!==t&&(a+=n),{date:r,dayName:r.toLocaleDateString([],{weekday:"short"}),totalMs:a}}),b=m.reduce((e,t)=>e+t.totalMs,0),k=Math.min(b,144e6),y=Math.max(0,b-144e6);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"This Week"}),(0,i.jsxs)("div",{style:{background:"linear-gradient(135deg, rgba(59,130,246,0.10), rgba(59,130,246,0.03))",border:"1px solid rgba(59,130,246,0.25)",borderRadius:"14px",padding:"16px",marginBottom:"16px"},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,i.jsx)(p,{label:"Total",value:s(b),color:"#e8ecf1"}),(0,i.jsx)(p,{label:"Regular",value:s(k),color:"#4ade80"}),(0,i.jsx)(p,{label:"OT",value:y>0?s(y):"—",color:y>0?"#f87171":"#4a5f78"})]}),(0,i.jsxs)("div",{style:{marginTop:"12px"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",marginBottom:"4px"},children:[(0,i.jsx)("span",{style:{color:"#4a5f78"},children:"Week Progress"}),(0,i.jsxs)("span",{style:{color:b>=144e6?"#f87171":"#60a5fa",fontWeight:700},children:[(b/36e5).toFixed(1)," / 40 hrs"]})]}),(0,i.jsx)("div",{style:{height:"8px",background:"#1e2d3d",borderRadius:"4px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(Math.min(b/144e6*100,100),"%"),background:b>=144e6?"linear-gradient(90deg, #22c55e 80%, #ef4444)":"#3b82f6",borderRadius:"4px"}})})]})]}),(0,i.jsx)("div",{style:{fontSize:"10px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Daily Breakdown"}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:m.map((e,t)=>{let n=e.totalMs/36e5,r=e.date.toDateString()===g.toDateString();return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",padding:"8px 12px",background:r?"rgba(59,130,246,0.06)":"#141e2b",border:r?"1px solid rgba(59,130,246,0.2)":"1px solid #1e2d3d",borderRadius:"8px"},children:[(0,i.jsx)("div",{style:{width:"36px",fontSize:"12px",fontWeight:700,color:r?"#60a5fa":"#6b7a8d"},children:e.dayName}),(0,i.jsx)("div",{style:{flex:1},children:(0,i.jsx)("div",{style:{height:"10px",background:"#1e2d3d",borderRadius:"5px",overflow:"hidden"},children:(0,i.jsx)("div",{style:{height:"100%",width:"".concat(Math.min(n/10*100,100),"%"),background:n>8?"linear-gradient(90deg, #3b82f6 80%, #f59e0b)":"#3b82f6",borderRadius:"5px"}})})}),(0,i.jsx)("div",{style:{width:"50px",textAlign:"right",fontSize:"13px",fontWeight:700,color:e.totalMs>0?"#e8ecf1":"#2a3a4f"},children:e.totalMs>0?s(e.totalMs):"—"})]},t)})})]})}function p(e){let{label:t,value:n,color:r}=e;return(0,i.jsxs)("div",{style:{background:"#141e2b",borderRadius:"8px",padding:"6px 10px",textAlign:"center",flex:1},children:[(0,i.jsx)("div",{style:{fontSize:"9px",color:"#4a5f78",fontWeight:600,textTransform:"uppercase"},children:t}),(0,i.jsx)("div",{style:{fontSize:"17px",fontWeight:800,color:r,marginTop:"1px"},children:n})]})}function g(e){return{width:"100%",padding:"10px",borderRadius:"10px",border:"none",background:e,color:"#fff",fontWeight:700,cursor:"pointer",fontFamily:"-apple-system, sans-serif"}}},7775:function(e,t,n){"use strict";n.d(t,{q:function(){return d},w:function(){return s}});var i=n(7437),r=n(2265),a=n(4754),l=n(2582);let o=(0,r.createContext)({});function s(e){let{children:t}=e,{user:n}=(0,l.a)(),s=(0,a.e)(),[d,c]=(0,r.useState)("out"),[u,x]=(0,r.useState)(null),[f,p]=(0,r.useState)(null),[g,h]=(0,r.useState)([]),[m,b]=(0,r.useState)(0),[k,y]=(0,r.useState)(null),[S,_]=(0,r.useState)(null),[v,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!n){j(!1);return}(async()=>{try{let{data:e}=await s.from("time_entries").select("*").eq("user_id",n.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(e){y(e),x(e.clock_in);let{data:t}=await s.from("time_breaks").select("*").eq("time_entry_id",e.id).order("break_start",{ascending:!0}),n=t||[];h(n);let i=n.find(e=>!e.break_end);i?(p(i.break_start),c("break")):c("in")}}catch(e){console.error("AppProvider load error:",e)}j(!1)})()},[n]),(0,r.useEffect)(()=>{if("out"===d||!u)return;let e=setInterval(()=>{let e=Date.now()-new Date(u).getTime();g.forEach(t=>{t.break_end&&(e-=new Date(t.break_end).getTime()-new Date(t.break_start).getTime())}),"break"===d&&f&&(e-=Date.now()-new Date(f).getTime()),b(Math.max(0,e))},1e3);return()=>clearInterval(e)},[d,u,f,g]);let w=(0,r.useCallback)(async()=>{if(!n)return;let e=new Date().toISOString(),{data:t,error:i}=await s.from("time_entries").insert({user_id:n.id,clock_in:e,status:"clocked_in"}).select().single();t&&!i&&(y(t),x(e),h([]),c("in"),b(0))},[n,s]),D=(0,r.useCallback)(async()=>{if(!k)return;let e=new Date().toISOString(),{data:t}=await s.from("time_breaks").insert({time_entry_id:k.id,break_start:e}).select().single();await s.from("time_entries").update({status:"on_break"}).eq("id",k.id),t&&(h(e=>[...e,t]),p(e),c("break"))},[k,s]),T=(0,r.useCallback)(async()=>{if(!k||!f)return;let e=new Date().toISOString(),t=g.find(e=>!e.break_end);t&&(await s.from("time_breaks").update({break_end:e}).eq("id",t.id),h(n=>n.map(n=>n.id===t.id?{...n,break_end:e}:n))),await s.from("time_entries").update({status:"clocked_in"}).eq("id",k.id),p(null),c("in")},[k,f,g,s]),C=(0,r.useCallback)(async()=>{if(!k||!u)return;let e=new Date,t=e.toISOString(),n=g.find(e=>!e.break_end);n&&await s.from("time_breaks").update({break_end:t}).eq("id",n.id);let i=e.getTime()-new Date(u).getTime();g.map(e=>({...e,break_end:e.break_end||t})).forEach(e=>{i-=new Date(e.break_end).getTime()-new Date(e.break_start).getTime()}),await s.from("time_entries").update({clock_out:t,status:"clocked_out",total_ms:Math.max(0,i)}).eq("id",k.id),c("out"),x(null),p(null),h([]),b(0),y(null)},[k,u,g,s]);return(0,i.jsx)(o.Provider,{value:{clockStatus:d,clockInTime:u,breakStartTime:f,currentBreaks:g,elapsed:m,activeTimeEntry:k,doClockIn:w,doStartBreak:D,doEndBreak:T,doClockOut:C,activePart:S,setActivePart:_,appLoading:v},children:t})}let d=()=>(0,r.useContext)(o)},2582:function(e,t,n){"use strict";n.d(t,{H:function(){return o},a:function(){return s}});var i=n(7437),r=n(2265),a=n(4754);let l=(0,r.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function o(e){let{children:t}=e,[n,o]=(0,r.useState)(null),[s,d]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),x=(0,a.e)();(0,r.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:n}}=await x.auth.getSession(),i=null!==(t=null==n?void 0:n.user)&&void 0!==t?t:null;if(e)return;if(o(i),i){let{data:t}=await x.from("profiles").select("*").eq("id",i.id).maybeSingle();e||d(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||u(!1)})();let{data:{subscription:t}}=x.auth.onAuthStateChange(async(t,n)=>{try{var i;if(e)return;if(o(null!==(i=null==n?void 0:n.user)&&void 0!==i?i:null),null==n?void 0:n.user){let{data:t}=await x.from("profiles").select("*").eq("id",n.user.id).maybeSingle();e||d(t)}else d(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||u(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let f=async()=>{await x.auth.signOut(),o(null),d(null)};return(0,i.jsx)(l.Provider,{value:{user:n,profile:s,isAdmin:(null==s?void 0:s.role)==="admin",loading:c,signOut:f},children:t})}let s=()=>(0,r.useContext)(l)},4754:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});var i=n(4033),r=n(257);function a(){return(0,i.createBrowserClient)(r.env.NEXT_PUBLIC_SUPABASE_URL,r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=1082)}),_N_E=e.O()}]);