(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[972],{7813:function(e,t,r){Promise.resolve().then(r.bind(r,67))},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},67:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),a=r(2265),i=r(9376),l=r(4754),o=r(7775);function u(){let e=(0,i.useRouter)(),{activePart:t,setActivePart:r}=(0,o.q)(),[u,c]=(0,a.useState)([]),[d,f]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),[b,_]=(0,a.useState)(!0),x=(0,l.e)();(0,a.useEffect)(()=>{(async()=>{let{data:e}=await x.from("catalog").select("*").eq("active",!0).order("part_number");c(e||[]),_(!1)})()},[]);let g=Array.from(new Set(u.map(e=>e.customer))),h=u.filter(e=>{if(p&&e.customer!==p)return!1;if(d){let t=d.toLowerCase();return"".concat(e.part_number," ").concat(e.end_customer," ").concat(e.vehicle_type," ").concat(e.graphic_package).toLowerCase().includes(t)}return!0}),k=t=>{r(t),e.push("/home")};return b?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading catalog..."}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"Select Active Part Number"}),(0,n.jsx)("input",{value:d,onChange:e=>f(e.target.value),placeholder:"Search...",autoFocus:!0,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #1e2d3d",background:"#141e2b",color:"#e8ecf1",fontSize:"13px",marginBottom:"8px"}}),(0,n.jsxs)("div",{style:{display:"flex",gap:"6px",marginBottom:"12px",flexWrap:"wrap"},children:[(0,n.jsx)(s,{label:"All",active:!p,onClick:()=>m("")}),g.map(e=>(0,n.jsx)(s,{label:e,active:p===e,onClick:()=>m(e)},e))]}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:h.map(e=>{let r=(null==t?void 0:t.id)===e.id;return(0,n.jsxs)("button",{onClick:()=>k(e),style:{width:"100%",textAlign:"left",padding:"12px",borderRadius:"10px",cursor:"pointer",background:r?"rgba(59,130,246,0.06)":"#141e2b",border:r?"1px solid rgba(59,130,246,0.3)":"1px solid #1e2d3d",color:"#e8ecf1"},children:[(0,n.jsx)("div",{style:{fontWeight:800,fontSize:"15px"},children:e.part_number}),(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#93c5fd",marginTop:"1px"},children:[e.end_customer," — ",e.graphic_package]}),(0,n.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78"},children:[e.vehicle_type," • ",e.customer]})]},e.id)})}),(0,n.jsx)("button",{onClick:()=>e.back(),style:{width:"100%",padding:"10px",borderRadius:"10px",marginTop:"14px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"← Back"})]})}function s(e){let{label:t,active:r,onClick:a}=e;return(0,n.jsx)("button",{onClick:a,style:{padding:"4px 10px",borderRadius:"6px",fontSize:"11px",fontWeight:700,background:r?"rgba(59,130,246,0.12)":"transparent",border:r?"1px solid rgba(59,130,246,0.3)":"1px solid #1e2d3d",color:r?"#60a5fa":"#4a5f78"},children:t})}},7775:function(e,t,r){"use strict";r.d(t,{q:function(){return s},w:function(){return u}});var n=r(7437),a=r(2265),i=r(4754),l=r(2582);let o=(0,a.createContext)({});function u(e){let{children:t}=e,{user:r}=(0,l.a)(),u=(0,i.e)(),[s,c]=(0,a.useState)("out"),[d,f]=(0,a.useState)(null),[p,m]=(0,a.useState)(null),[b,_]=(0,a.useState)([]),[x,g]=(0,a.useState)(0),[h,k]=(0,a.useState)(null),[S,v]=(0,a.useState)(null),[w,y]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!r){y(!1);return}(async()=>{try{let{data:e}=await u.from("time_entries").select("*").eq("user_id",r.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(e){k(e),f(e.clock_in);let{data:t}=await u.from("time_breaks").select("*").eq("time_entry_id",e.id).order("break_start",{ascending:!0}),r=t||[];_(r);let n=r.find(e=>!e.break_end);n?(m(n.break_start),c("break")):c("in")}}catch(e){console.error("AppProvider load error:",e)}y(!1)})()},[r]),(0,a.useEffect)(()=>{if("out"===s||!d)return;let e=setInterval(()=>{let e=Date.now()-new Date(d).getTime();b.forEach(t=>{t.break_end&&(e-=new Date(t.break_end).getTime()-new Date(t.break_start).getTime())}),"break"===s&&p&&(e-=Date.now()-new Date(p).getTime()),g(Math.max(0,e))},1e3);return()=>clearInterval(e)},[s,d,p,b]);let C=(0,a.useCallback)(async()=>{if(!r)return;let e=new Date().toISOString(),{data:t,error:n}=await u.from("time_entries").insert({user_id:r.id,clock_in:e,status:"clocked_in"}).select().single();t&&!n&&(k(t),f(e),_([]),c("in"),g(0))},[r,u]),A=(0,a.useCallback)(async()=>{if(!h)return;let e=new Date().toISOString(),{data:t}=await u.from("time_breaks").insert({time_entry_id:h.id,break_start:e}).select().single();await u.from("time_entries").update({status:"on_break"}).eq("id",h.id),t&&(_(e=>[...e,t]),m(e),c("break"))},[h,u]),P=(0,a.useCallback)(async()=>{if(!h||!p)return;let e=new Date().toISOString(),t=b.find(e=>!e.break_end);t&&(await u.from("time_breaks").update({break_end:e}).eq("id",t.id),_(r=>r.map(r=>r.id===t.id?{...r,break_end:e}:r))),await u.from("time_entries").update({status:"clocked_in"}).eq("id",h.id),m(null),c("in")},[h,p,b,u]),j=(0,a.useCallback)(async()=>{if(!h||!d)return;let e=new Date,t=e.toISOString(),r=b.find(e=>!e.break_end);r&&await u.from("time_breaks").update({break_end:t}).eq("id",r.id);let n=e.getTime()-new Date(d).getTime();b.map(e=>({...e,break_end:e.break_end||t})).forEach(e=>{n-=new Date(e.break_end).getTime()-new Date(e.break_start).getTime()}),await u.from("time_entries").update({clock_out:t,status:"clocked_out",total_ms:Math.max(0,n)}).eq("id",h.id),c("out"),f(null),m(null),_([]),g(0),k(null)},[h,d,b,u]);return(0,n.jsx)(o.Provider,{value:{clockStatus:s,clockInTime:d,breakStartTime:p,currentBreaks:b,elapsed:x,activeTimeEntry:h,doClockIn:C,doStartBreak:A,doEndBreak:P,doClockOut:j,activePart:S,setActivePart:v,appLoading:w},children:t})}let s=()=>(0,a.useContext)(o)},2582:function(e,t,r){"use strict";r.d(t,{H:function(){return o},a:function(){return u}});var n=r(7437),a=r(2265),i=r(4754);let l=(0,a.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[u,s]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0),f=(0,i.e)();(0,a.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:r}}=await f.auth.getSession(),n=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;if(e)return;if(o(n),n){let{data:t}=await f.from("profiles").select("*").eq("id",n.id).maybeSingle();e||s(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||d(!1)})();let{data:{subscription:t}}=f.auth.onAuthStateChange(async(t,r)=>{try{var n;if(e)return;if(o(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),null==r?void 0:r.user){let{data:t}=await f.from("profiles").select("*").eq("id",r.user.id).maybeSingle();e||s(t)}else s(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||d(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let p=async()=>{await f.auth.signOut(),o(null),s(null)};return(0,n.jsx)(l.Provider,{value:{user:r,profile:u,isAdmin:(null==u?void 0:u.role)==="admin",loading:c,signOut:p},children:t})}let u=()=>(0,a.useContext)(l)},4754:function(e,t,r){"use strict";r.d(t,{e:function(){return i}});var n=r(4033),a=r(257);function i(){return(0,n.createBrowserClient)(a.env.NEXT_PUBLIC_SUPABASE_URL,a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=7813)}),_N_E=e.O()}]);