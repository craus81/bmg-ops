(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{5927:function(e,t,i){Promise.resolve().then(i.bind(i,5176))},9376:function(e,t,i){"use strict";var n=i(5475);i.o(n,"useParams")&&i.d(t,{useParams:function(){return n.useParams}}),i.o(n,"usePathname")&&i.d(t,{usePathname:function(){return n.usePathname}}),i.o(n,"useRouter")&&i.d(t,{useRouter:function(){return n.useRouter}}),i.o(n,"useSearchParams")&&i.d(t,{useSearchParams:function(){return n.useSearchParams}})},5176:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var n=i(7437),r=i(2265),l=i(9376),s=i(4754),o=i(2582);function d(){let e=(0,l.useRouter)(),{isAdmin:t,user:i}=(0,o.a)(),d=(0,s.e)(),[u,p]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[f,g]=(0,r.useState)(!0),[m,y]=(0,r.useState)(!1),[b,v]=(0,r.useState)(null),[j,_]=(0,r.useState)({po_number:"",customer:"Masterack"}),[S,w]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!t){e.push("/home");return}(async()=>{let{data:e}=await d.from("purchase_orders").select("*, po_line_items(*)").order("created_at",{ascending:!1});p((e||[]).map(e=>({...e,line_items:e.po_line_items||[]})));let{data:t}=await d.from("catalog").select("*").eq("active",!0).order("part_number");h(t||[]),g(!1)})()},[t]);let A=e=>{let t=x.find(t=>t.id===e);t&&w(e=>[...e,{catalog_id:t.id,part_number:t.part_number,quantity:1,unit_price:t.price}])},C=async()=>{if(!j.po_number||!j.customer||0===S.length||!i)return;let{data:e,error:t}=await d.from("purchase_orders").insert({po_number:j.po_number,customer:j.customer,created_by:i.id}).select().single();if(!e||t){alert("Error: "+(null==t?void 0:t.message));return}let{data:n}=await d.from("po_line_items").insert(S.map(t=>({po_id:e.id,...t}))).select();p(t=>[{...e,line_items:n||[]},...t]),_({po_number:"",customer:"Masterack"}),w([]),y(!1)},k=e=>{v(b===e?null:e)},P=e=>"$"+e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");return f?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading..."}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[(0,n.jsxs)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px"},children:["Purchase Orders (",u.length,")"]}),(0,n.jsx)("button",{onClick:()=>y(!m),style:{padding:"6px 12px",borderRadius:"8px",background:"#3b82f6",color:"#fff",fontSize:"12px",fontWeight:700,border:"none"},children:m?"Cancel":"+ New PO"})]}),m&&(0,n.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"14px",marginBottom:"12px"},children:[(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,n.jsx)("label",{style:a,children:"PO Number"}),(0,n.jsx)("input",{value:j.po_number,onChange:e=>_({...j,po_number:e.target.value}),style:c})]}),(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,n.jsx)("label",{style:a,children:"Customer"}),(0,n.jsxs)("select",{value:j.customer,onChange:e=>_({...j,customer:e.target.value}),style:c,children:[(0,n.jsx)("option",{children:"Masterack"}),(0,n.jsx)("option",{children:"Knapheide"}),(0,n.jsx)("option",{children:"Bodewell"}),(0,n.jsx)("option",{children:"Designs That Stick"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,n.jsx)("label",{style:a,children:"Add Part Number"}),(0,n.jsxs)("select",{onChange:e=>{e.target.value&&A(e.target.value),e.target.value=""},style:c,children:[(0,n.jsx)("option",{value:"",children:"Select part number..."}),x.filter(e=>e.customer===j.customer).map(e=>(0,n.jsxs)("option",{value:e.id,children:[e.part_number," — ",e.end_customer," ($",e.price,")"]},e.id))]})]}),S.length>0&&(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:[S.map((e,t)=>(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 0",borderBottom:"1px solid #1e2d3d"},children:[(0,n.jsx)("div",{style:{flex:1,fontSize:"13px",fontWeight:700},children:e.part_number}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#4a5f78"},children:P(e.unit_price)}),(0,n.jsx)("input",{type:"number",value:e.quantity,onChange:e=>{let i=parseInt(e.target.value)||1;w(e=>e.map((e,n)=>n===t?{...e,quantity:i}:e))},style:{...c,width:"60px",textAlign:"center"},min:1}),(0,n.jsx)("button",{onClick:()=>w(e=>e.filter((e,i)=>i!==t)),style:{color:"#f87171",fontSize:"18px",padding:"0 4px",background:"none",border:"none"},children:"\xd7"})]},t)),(0,n.jsxs)("div",{style:{textAlign:"right",marginTop:"6px",fontSize:"13px",fontWeight:700,color:"#60a5fa"},children:["Total: ",P(S.reduce((e,t)=>e+t.quantity*t.unit_price,0))]})]}),(0,n.jsx)("button",{onClick:C,disabled:!j.po_number||0===S.length,style:{width:"100%",padding:"12px",borderRadius:"10px",background:"#22c55e",color:"#fff",fontWeight:800,fontSize:"14px",border:"none",opacity:j.po_number&&S.length>0?1:.4},children:"Create PO"})]}),0===u.length&&(0,n.jsxs)("div",{style:{textAlign:"center",padding:"32px 0",color:"#4a5f78"},children:[(0,n.jsx)("div",{style:{fontSize:"36px",marginBottom:"6px",opacity:.4},children:"\uD83D\uDCCB"}),(0,n.jsx)("div",{style:{fontWeight:600,fontSize:"13px"},children:"No purchase orders yet"})]}),u.map(e=>{let t=e.line_items.reduce((e,t)=>e+t.quantity,0),i=e.line_items.reduce((e,t)=>e+t.installed,0),r=e.line_items.reduce((e,t)=>e+t.quantity*t.unit_price,0),l=t>0?i/t*100:0,s=b===e.id,o=new Date(e.created_at);return(0,n.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",marginBottom:"6px",overflow:"hidden"},children:[(0,n.jsxs)("div",{onClick:()=>k(e.id),style:{padding:"12px",cursor:"pointer"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{fontWeight:800,fontSize:"15px"},children:["PO #",e.po_number]}),(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#4a5f78",marginTop:"1px"},children:[e.customer," • ",e.line_items.length," item",1!==e.line_items.length?"s":"","complete"===e.status&&(0,n.jsx)("span",{style:{color:"#4ade80",marginLeft:"6px"},children:"✓ Complete"})]})]}),(0,n.jsxs)("div",{style:{textAlign:"right"},children:[(0,n.jsx)("div",{style:{fontSize:"14px",fontWeight:800,color:"#60a5fa"},children:P(r)}),(0,n.jsxs)("div",{style:{fontSize:"10px",color:"#4a5f78",marginTop:"1px"},children:[s?"▲":"▼"," Details"]})]})]}),(0,n.jsxs)("div",{style:{marginTop:"8px"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",marginBottom:"3px"},children:[(0,n.jsx)("span",{style:{color:"#4a5f78"},children:"Progress"}),(0,n.jsxs)("span",{style:{color:l>=100?"#4ade80":"#60a5fa",fontWeight:700},children:[i,"/",t]})]}),(0,n.jsx)("div",{style:{height:"6px",background:"#1e2d3d",borderRadius:"3px"},children:(0,n.jsx)("div",{style:{height:"100%",width:"".concat(Math.min(l,100),"%"),background:l>=100?"#22c55e":"#3b82f6",borderRadius:"3px",transition:"width 0.3s"}})})]})]}),s&&(0,n.jsxs)("div",{style:{borderTop:"1px solid #1e2d3d",padding:"10px 12px"},children:[(0,n.jsxs)("div",{style:{fontSize:"10px",color:"#4a5f78",marginBottom:"2px"},children:["Created ",o.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"4px",padding:"8px 0 4px",borderBottom:"1px solid #1e2d3d",fontSize:"10px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.3px"},children:[(0,n.jsx)("div",{style:{flex:1},children:"Part #"}),(0,n.jsx)("div",{style:{width:"36px",textAlign:"center"},children:"Qty"}),(0,n.jsx)("div",{style:{width:"42px",textAlign:"center"},children:"Done"}),(0,n.jsx)("div",{style:{width:"65px",textAlign:"right"},children:"Price"}),(0,n.jsx)("div",{style:{width:"75px",textAlign:"right"},children:"Line Total"})]}),e.line_items.map(e=>{let t=e.quantity*e.unit_price,i=e.quantity>0?e.installed/e.quantity*100:0;return(0,n.jsxs)("div",{style:{display:"flex",gap:"4px",padding:"8px 0",borderBottom:"1px solid rgba(30,45,61,0.5)",alignItems:"center",fontSize:"12px"},children:[(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{style:{fontWeight:700,color:"#e8ecf1"},children:e.part_number}),(0,n.jsx)("div",{style:{height:"3px",background:"#1e2d3d",borderRadius:"2px",marginTop:"3px",width:"80%"},children:(0,n.jsx)("div",{style:{height:"100%",width:"".concat(Math.min(i,100),"%"),background:i>=100?"#22c55e":"#3b82f6",borderRadius:"2px"}})})]}),(0,n.jsx)("div",{style:{width:"36px",textAlign:"center",color:"#6b7a8d",fontWeight:600},children:e.quantity}),(0,n.jsx)("div",{style:{width:"42px",textAlign:"center",fontWeight:700,color:e.installed>=e.quantity?"#4ade80":"#fbbf24"},children:e.installed}),(0,n.jsx)("div",{style:{width:"65px",textAlign:"right",color:"#6b7a8d",fontSize:"11px"},children:P(e.unit_price)}),(0,n.jsx)("div",{style:{width:"75px",textAlign:"right",fontWeight:700,color:"#e8ecf1"},children:P(t)})]},e.id)}),(0,n.jsxs)("div",{style:{display:"flex",gap:"4px",padding:"10px 0 4px",fontSize:"13px"},children:[(0,n.jsx)("div",{style:{flex:1,fontWeight:800,color:"#e8ecf1"},children:"Total"}),(0,n.jsx)("div",{style:{width:"36px",textAlign:"center",fontWeight:700,color:"#6b7a8d"},children:t}),(0,n.jsx)("div",{style:{width:"42px",textAlign:"center",fontWeight:700,color:i>=t?"#4ade80":"#60a5fa"},children:i}),(0,n.jsx)("div",{style:{width:"65px"}}),(0,n.jsx)("div",{style:{width:"75px",textAlign:"right",fontWeight:800,color:"#60a5fa"},children:P(r)})]})]})]},e.id)}),(0,n.jsx)("button",{onClick:()=>e.push("/more"),style:{width:"100%",padding:"10px",borderRadius:"10px",marginTop:"14px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"← Back"})]})}let a={display:"block",fontSize:"10px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"4px"},c={width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #1e2d3d",background:"#0f1720",color:"#e8ecf1",fontSize:"13px"}},2582:function(e,t,i){"use strict";i.d(t,{H:function(){return o},a:function(){return d}});var n=i(7437),r=i(2265),l=i(4754);let s=(0,r.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function o(e){let{children:t}=e,[i,o]=(0,r.useState)(null),[d,a]=(0,r.useState)(null),[c,u]=(0,r.useState)(!0),p=(0,l.e)();(0,r.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:i}}=await p.auth.getSession(),n=null!==(t=null==i?void 0:i.user)&&void 0!==t?t:null;if(e)return;if(o(n),n){let{data:t}=await p.from("profiles").select("*").eq("id",n.id).maybeSingle();e||a(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||u(!1)})();let{data:{subscription:t}}=p.auth.onAuthStateChange(async(t,i)=>{try{var n;if(e)return;if(o(null!==(n=null==i?void 0:i.user)&&void 0!==n?n:null),null==i?void 0:i.user){let{data:t}=await p.from("profiles").select("*").eq("id",i.user.id).maybeSingle();e||a(t)}else a(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||u(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let x=async()=>{await p.auth.signOut(),o(null),a(null)};return(0,n.jsx)(s.Provider,{value:{user:i,profile:d,isAdmin:(null==d?void 0:d.role)==="admin",loading:c,signOut:x},children:t})}let d=()=>(0,r.useContext)(s)},4754:function(e,t,i){"use strict";i.d(t,{e:function(){return l}});var n=i(4033),r=i(257);function l(){return(0,n.createBrowserClient)(r.env.NEXT_PUBLIC_SUPABASE_URL,r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=5927)}),_N_E=e.O()}]);