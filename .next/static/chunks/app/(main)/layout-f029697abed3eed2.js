(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95],{7160:function(e,t,n){Promise.resolve().then(n.bind(n,5566))},9376:function(e,t,n){"use strict";var i=n(5475);n.o(i,"useParams")&&n.d(t,{useParams:function(){return i.useParams}}),n.o(i,"usePathname")&&n.d(t,{usePathname:function(){return i.usePathname}}),n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})},5566:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var i=n(7437),r=n(2582),a=n(7775);function l(e){let{clockStatus:t,activePartNumber:n,activeEndCustomer:a}=e,{profile:l,isAdmin:s}=(0,r.a)(),o="in"===t?"\uD83D\uDFE2 Clocked In":"break"===t?"\uD83D\uDFE1 On Break":n?"".concat(n," • ").concat(a):"";return(0,i.jsxs)("header",{style:{background:"#141e2b",borderBottom:"1px solid #1e2d3d",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:100},children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,i.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:"11px",color:"#fff"},children:"BMG"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[(0,i.jsx)("span",{style:{fontWeight:700,fontSize:"14px"},children:"BMG Ops"}),(0,i.jsx)("span",{style:{background:s?"rgba(139,92,246,0.12)":"rgba(59,130,246,0.12)",border:"1px solid ".concat(s?"rgba(139,92,246,0.3)":"rgba(59,130,246,0.3)"),borderRadius:"5px",color:s?"#a78bfa":"#60a5fa",padding:"2px 6px",fontSize:"9px",fontWeight:700},children:s?"Admin":"Crew"})]}),o&&(0,i.jsx)("div",{style:{fontSize:"10px",color:"#4a5f78"},children:o})]})]}),(0,i.jsx)("div",{style:{fontSize:"11px",color:"#4a5f78"},children:null==l?void 0:l.full_name})]})}var s=n(9376);let o=[{id:"home",path:"/home",label:"Home",icon:"\uD83C\uDFE0"},{id:"time",path:"/time",label:"Time Clock",icon:"⏰"},{id:"vehicles",path:"/vehicles",label:"Vehicles",icon:"\uD83D\uDE90"},{id:"more",path:"/more",label:"More",icon:"⋯"}];function u(e){let{clockStatus:t}=e,n=(0,s.usePathname)(),r=(0,s.useRouter)(),a=e=>{if("time"===e.id){if("in"===t)return"\uD83D\uDFE2";if("break"===t)return"\uD83D\uDFE1"}return e.icon},l=e=>"/home"===e.path?"/home"===n||"/scan"===n||"/select-part"===n||"/photos"===n:n.startsWith(e.path);return(0,i.jsx)("nav",{style:{position:"fixed",bottom:0,left:0,right:0,background:"#141e2b",borderTop:"1px solid #1e2d3d",display:"flex",zIndex:100,paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:o.map(e=>(0,i.jsxs)("button",{onClick:()=>r.push(e.path),style:{flex:1,padding:"8px 4px 10px",display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",color:l(e)?"#60a5fa":"#4a5f78"},children:[(0,i.jsx)("div",{style:{fontSize:"18px"},children:a(e)}),(0,i.jsx)("div",{style:{fontSize:"10px",fontWeight:700},children:e.label})]},e.id))})}function d(e){let{children:t}=e,{loading:n}=(0,r.a)(),{clockStatus:s,activePart:o,appLoading:d}=(0,a.q)();return n||d?(0,i.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("div",{style:{width:"36px",height:"36px",border:"3px solid #1e2d3d",borderTopColor:"#3b82f6",borderRadius:"50%",margin:"0 auto",animation:"spin 1s linear infinite"}}),(0,i.jsx)("div",{style:{color:"#4a5f78",marginTop:"12px",fontSize:"13px"},children:"Loading..."})]})}):(0,i.jsxs)("div",{style:{minHeight:"100vh",paddingBottom:"70px"},children:[(0,i.jsx)(l,{clockStatus:s,activePartNumber:null==o?void 0:o.part_number,activeEndCustomer:null==o?void 0:o.end_customer}),(0,i.jsx)("div",{style:{maxWidth:"500px",margin:"0 auto",padding:"14px 20px"},children:t}),(0,i.jsx)(u,{clockStatus:s})]})}function c(e){let{children:t}=e;return(0,i.jsx)(r.H,{children:(0,i.jsx)(a.w,{children:(0,i.jsx)(d,{children:t})})})}},7775:function(e,t,n){"use strict";n.d(t,{q:function(){return u},w:function(){return o}});var i=n(7437),r=n(2265),a=n(4754),l=n(2582);let s=(0,r.createContext)({});function o(e){let{children:t}=e,{user:n}=(0,l.a)(),o=(0,a.e)(),[u,d]=(0,r.useState)("out"),[c,f]=(0,r.useState)(null),[m,p]=(0,r.useState)(null),[h,x]=(0,r.useState)([]),[b,g]=(0,r.useState)(0),[_,k]=(0,r.useState)(null),[v,y]=(0,r.useState)(null),[S,w]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!n){w(!1);return}(async()=>{try{let{data:e}=await o.from("time_entries").select("*").eq("user_id",n.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(e){k(e),f(e.clock_in);let{data:t}=await o.from("time_breaks").select("*").eq("time_entry_id",e.id).order("break_start",{ascending:!0}),n=t||[];x(n);let i=n.find(e=>!e.break_end);i?(p(i.break_start),d("break")):d("in")}}catch(e){console.error("AppProvider load error:",e)}w(!1)})()},[n]),(0,r.useEffect)(()=>{if("out"===u||!c)return;let e=setInterval(()=>{let e=Date.now()-new Date(c).getTime();h.forEach(t=>{t.break_end&&(e-=new Date(t.break_end).getTime()-new Date(t.break_start).getTime())}),"break"===u&&m&&(e-=Date.now()-new Date(m).getTime()),g(Math.max(0,e))},1e3);return()=>clearInterval(e)},[u,c,m,h]);let D=(0,r.useCallback)(async()=>{if(!n)return;let e=new Date().toISOString(),{data:t,error:i}=await o.from("time_entries").insert({user_id:n.id,clock_in:e,status:"clocked_in"}).select().single();t&&!i&&(k(t),f(e),x([]),d("in"),g(0))},[n,o]),j=(0,r.useCallback)(async()=>{if(!_)return;let e=new Date().toISOString(),{data:t}=await o.from("time_breaks").insert({time_entry_id:_.id,break_start:e}).select().single();await o.from("time_entries").update({status:"on_break"}).eq("id",_.id),t&&(x(e=>[...e,t]),p(e),d("break"))},[_,o]),C=(0,r.useCallback)(async()=>{if(!_||!m)return;let e=new Date().toISOString(),t=h.find(e=>!e.break_end);t&&(await o.from("time_breaks").update({break_end:e}).eq("id",t.id),x(n=>n.map(n=>n.id===t.id?{...n,break_end:e}:n))),await o.from("time_entries").update({status:"clocked_in"}).eq("id",_.id),p(null),d("in")},[_,m,h,o]),E=(0,r.useCallback)(async()=>{if(!_||!c)return;let e=new Date,t=e.toISOString(),n=h.find(e=>!e.break_end);n&&await o.from("time_breaks").update({break_end:t}).eq("id",n.id);let i=e.getTime()-new Date(c).getTime();h.map(e=>({...e,break_end:e.break_end||t})).forEach(e=>{i-=new Date(e.break_end).getTime()-new Date(e.break_start).getTime()}),await o.from("time_entries").update({clock_out:t,status:"clocked_out",total_ms:Math.max(0,i)}).eq("id",_.id),d("out"),f(null),p(null),x([]),g(0),k(null)},[_,c,h,o]);return(0,i.jsx)(s.Provider,{value:{clockStatus:u,clockInTime:c,breakStartTime:m,currentBreaks:h,elapsed:b,activeTimeEntry:_,doClockIn:D,doStartBreak:j,doEndBreak:C,doClockOut:E,activePart:v,setActivePart:y,appLoading:S},children:t})}let u=()=>(0,r.useContext)(s)},2582:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return o}});var i=n(7437),r=n(2265),a=n(4754);let l=(0,r.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function s(e){let{children:t}=e,[n,s]=(0,r.useState)(null),[o,u]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),f=(0,a.e)();(0,r.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:n}}=await f.auth.getSession(),i=null!==(t=null==n?void 0:n.user)&&void 0!==t?t:null;if(e)return;if(s(i),i){let{data:t}=await f.from("profiles").select("*").eq("id",i.id).maybeSingle();e||u(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||c(!1)})();let{data:{subscription:t}}=f.auth.onAuthStateChange(async(t,n)=>{try{var i;if(e)return;if(s(null!==(i=null==n?void 0:n.user)&&void 0!==i?i:null),null==n?void 0:n.user){let{data:t}=await f.from("profiles").select("*").eq("id",n.user.id).maybeSingle();e||u(t)}else u(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||c(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let m=async()=>{await f.auth.signOut(),s(null),u(null)};return(0,i.jsx)(l.Provider,{value:{user:n,profile:o,isAdmin:(null==o?void 0:o.role)==="admin",loading:d,signOut:m},children:t})}let o=()=>(0,r.useContext)(l)},4754:function(e,t,n){"use strict";n.d(t,{e:function(){return a}});var i=n(4033),r=n(257);function a(){return(0,i.createBrowserClient)(r.env.NEXT_PUBLIC_SUPABASE_URL,r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=7160)}),_N_E=e.O()}]);