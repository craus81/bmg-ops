(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{5065:function(e,t,r){Promise.resolve().then(r.bind(r,3438))},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},3438:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),i=r(2265),a=r(9376),o=r(4754),d=r(7775),s=r(2582);async function l(e){try{var t;let r=new AbortController,n=setTimeout(()=>r.abort(),3e3),i=await fetch("https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/".concat(e,"?format=json"),{signal:r.signal});clearTimeout(n);let a=await i.json(),o=null===(t=a.Results)||void 0===t?void 0:t[0];if(null==o?void 0:o.Make)return{year:o.ModelYear||"",make:o.Make||"",model:o.Model||"",trim:o.Trim||"",bodyClass:o.BodyClass||"",driveType:o.DriveType||"",fuelType:o.FuelTypePrimary||"",doors:o.Doors||"",gvwr:o.GVWR||""}}catch(e){}return function(e){let t=e.toUpperCase(),r={A:"2010",B:"2011",C:"2012",D:"2013",E:"2014",F:"2015",G:"2016",H:"2017",J:"2018",K:"2019",L:"2020",M:"2021",N:"2022",P:"2023",R:"2024",S:"2025",T:"2026",V:"2027",W:"2028",1:"2001",2:"2002",3:"2003",4:"2004",5:"2005",6:"2006",7:"2007",8:"2008",9:"2009"}[t[9]]||"",n={"1FT":"Ford","2FT":"Ford","3FT":"Ford","1FA":"Ford","1FM":"Ford","3FA":"Ford","1FD":"Ford","1FB":"Ford","1FC":"Ford","1GC":"Chevrolet","1G1":"Chevrolet","2G1":"Chevrolet","1GT":"GMC","1GD":"GMC","1C4":"Jeep","1C6":"RAM","3C6":"RAM","2C3":"Dodge","2D7":"RAM",WDB:"Mercedes-Benz",WDD:"Mercedes-Benz",WDF:"Mercedes-Benz",WD3:"Mercedes-Benz",WD4:"Mercedes-Benz","5J6":"Honda","1HG":"Honda",JTD:"Toyota","4T1":"Toyota","5NM":"Hyundai","5XY":"Kia","1N4":"Nissan","1N6":"Nissan",WBA:"BMW",NM0:"Ford",MAJ:"Ford"}[t.substring(0,3)]||"";n||(n=({"1F":"Ford","2F":"Ford","3F":"Ford","1G":"GM","2G":"GM","1C":"Chrysler","2C":"Dodge","3C":"RAM",WD:"Mercedes-Benz",JT:"Toyota","1N":"Nissan",WB:"BMW"})[t.substring(0,2)]||"Unknown");let i="Vehicle",a="";return n.includes("Ford")?t.startsWith("1FTBW")||t.startsWith("1FTNW")?(i="Transit",a="Van"):t.startsWith("1FTBR")?(i="Transit",a="Wagon"):t.startsWith("1FTFW")||t.startsWith("1FTEW")?(i="F-150",a="Pickup"):t.startsWith("1FT7W")||t.startsWith("1FT8W")?(i="F-250/F-350",a="Pickup"):t.startsWith("3FTTW")?(i="Transit",a="Cargo Van"):t.startsWith("MAJ")?(i="Transit Connect",a="Van"):t.startsWith("NM0")&&(i="Transit",a="Van"):n.includes("RAM")||n.includes("Dodge")?"6"===t[3]?(i="ProMaster",a="Van"):(i="RAM",a="Pickup/Van"):n.includes("Mercedes")&&(i="Sprinter",a="Van"),{year:r,make:n.replace(/ \(.*\)/,""),model:i,trim:"",bodyClass:a,driveType:"",fuelType:"",doors:"",gvwr:""}}(e)}function c(e){return!!e&&17===e.length&&/^[A-HJ-NPR-Z0-9]{17}$/i.test(e)}function u(){let e=(0,a.useRouter)(),{user:t}=(0,s.a)(),{activePart:u}=(0,d.q)(),p=(0,o.e)(),[f,x]=(0,i.useState)(""),[g,h]=(0,i.useState)(""),[m,b]=(0,i.useState)(!1),[v,y]=(0,i.useState)(null),[_,S]=(0,i.useState)(!1),[k,T]=(0,i.useState)(null),[w,j]=(0,i.useState)(""),[C,F]=(0,i.useState)(""),[R,W]=(0,i.useState)("text"),[D,A]=(0,i.useState)(!1),[B,z]=(0,i.useState)(""),[M,N]=(0,i.useState)(""),[E,P]=(0,i.useState)(0),I=(0,i.useRef)(null),O=(0,i.useRef)(null),V=(0,i.useRef)(null),q=(0,i.useRef)(null),H=(0,i.useRef)(null),U=(0,i.useRef)(!1),G=(0,i.useRef)(null),J=(0,i.useRef)(0);(0,i.useEffect)(()=>{"text"===R&&I.current&&I.current.focus()},[R]),(0,i.useEffect)(()=>()=>{L()},[]);let L=()=>{H.current&&(clearInterval(H.current),H.current=null),q.current&&(q.current.getTracks().forEach(function(e){e.stop()}),q.current=null),O.current&&(O.current.srcObject=null),A(!1)},K=async()=>{z(""),U.current=!1,N(""),P(0),J.current=0;try{var e,t=await r.e(621).then(r.bind(r,2621)),n=[t.BarcodeFormat.CODE_128,t.BarcodeFormat.CODE_39,t.BarcodeFormat.CODE_93,t.BarcodeFormat.DATA_MATRIX,t.BarcodeFormat.QR_CODE,t.BarcodeFormat.PDF_417,t.BarcodeFormat.ITF],i=new Map;i.set(t.DecodeHintType.POSSIBLE_FORMATS,n),i.set(t.DecodeHintType.TRY_HARDER,!0);var a=new t.MultiFormatReader;a.setHints(i),G.current=a;var o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});if(q.current=o,!O.current)return;O.current.srcObject=o,await O.current.play(),A(!0),H.current=setInterval(function(){X(t)},200)}catch(t){(null==t?void 0:t.name)==="NotAllowedError"||(null==t?void 0:null===(e=t.message)||void 0===e?void 0:e.includes("Permission"))?z("Camera permission denied. Allow camera access in your browser settings, or use text input."):(null==t?void 0:t.name)==="NotFoundError"?z("No camera found. Use text input instead."):z("Camera error: "+((null==t?void 0:t.message)||"Unknown error"))}},X=e=>{if(!U.current&&O.current&&V.current&&G.current){var t=O.current;if(t.readyState===t.HAVE_ENOUGH_DATA){var r=V.current,n=r.getContext("2d");if(n){r.width=t.videoWidth,r.height=t.videoHeight,n.drawImage(t,0,0),J.current=J.current+1,P(J.current);try{for(var i=n.getImageData(0,0,r.width,r.height),a=i.data.length/4,o=new Uint8ClampedArray(a),d=0;d<a;d++){var s=i.data[4*d],l=i.data[4*d+1],u=i.data[4*d+2];o[d]=Math.round(.299*s+.587*l+.114*u)}var p=new e.RGBLuminanceSource(o,r.width,r.height),f=new e.BinaryBitmap(new e.HybridBinarizer(p)),g=G.current.decode(f).getText().trim().toUpperCase().replace(/[^A-HJ-NPR-Z0-9]/g,"");N(g),17===g.length&&c(g)&&(U.current=!0,L(),x(g),Y(g))}catch(e){}}}}},Y=async e=>{h(""),b(!0);try{var t=await l(e);y({vin:e,vehicle:t})}catch(e){h("Failed to decode VIN.")}b(!1)},Z=()=>{L(),W("text")},Q=async()=>{var e=f.trim().toUpperCase();if(!c(e)){h("Invalid VIN - must be 17 characters.");return}Y(e)},$=async()=>{if(v&&t){var e=v.vin,r=v.vehicle,n=null;if(j(""),F(""),h(""),u){var{data:i}=await p.from("po_line_items").select("*, purchase_orders!inner(id, po_number, status)").eq("part_number",u.part_number).eq("purchase_orders.status","open"),a=(i||[]).find(function(e){return e.installed<e.quantity});a?(n=a.id,F("PO #"+a.purchase_orders.po_number+" ("+(a.installed+1)+"/"+a.quantity+")")):j("No open PO found for part "+u.part_number)}var o=await p.from("scanned_vehicles").insert({vin:e,vehicle_year:r.year,vehicle_make:r.make,vehicle_model:r.model,vehicle_trim:r.trim,body_class:r.bodyClass,drive_type:r.driveType,fuel_type:r.fuelType,gvwr:r.gvwr,catalog_id:(null==u?void 0:u.id)||null,part_number:(null==u?void 0:u.part_number)||null,customer:(null==u?void 0:u.customer)||null,end_customer:(null==u?void 0:u.end_customer)||null,po_line_item_id:n,scanned_by:t.id}).select().single();if(o.error){h("Failed to save: "+o.error.message);return}if(n){await p.rpc("increment_po_installed",{p_line_id:n});var d=(i||[]).find(function(e){return e.id===n});if(d){var s=d.purchase_orders.id,{data:l}=await p.from("po_line_items").select("quantity, installed").eq("po_id",s);(l||[]).every(function(e){return e.installed>=e.quantity})&&(await p.from("purchase_orders").update({status:"complete"}).eq("id",s),F(function(e){return e+" - PO COMPLETE!"}))}}T(o.data.id),S(!0)}},ee=()=>{y(null),S(!1),x(""),T(null),h(""),j(""),F(""),N(""),U.current=!1,P(0),J.current=0,W("camera"),setTimeout(function(){K()},300)};var et=v?[v.vehicle.year,v.vehicle.make,v.vehicle.model].filter(Boolean).join(" "):"";return v||m||_?m?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"60px 0"},children:[(0,n.jsx)("div",{style:{width:"36px",height:"36px",border:"3px solid #1e2d3d",borderTopColor:"#3b82f6",borderRadius:"50%",margin:"0 auto",animation:"spin 1s linear infinite"}}),(0,n.jsx)("div",{style:{color:"#93c5fd",fontWeight:600,marginTop:"12px"},children:"Decoding VIN..."})]}):_?(0,n.jsxs)("div",{style:{textAlign:"center",padding:"28px 0"},children:[(0,n.jsx)("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:w?"rgba(251,191,36,0.12)":"rgba(34,197,94,0.12)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 14px",fontSize:"30px",color:w?"#fbbf24":"#4ade80"},children:w?"!":"OK"}),(0,n.jsx)("div",{style:{fontSize:"18px",fontWeight:800},children:"Vehicle Recorded"}),(0,n.jsx)("div",{style:{color:"#6b7a8d",fontSize:"13px",marginTop:"4px"},children:et}),(0,n.jsx)("div",{style:{fontFamily:"monospace",fontSize:"11px",color:"#4a5f78"},children:v.vin}),C&&(0,n.jsx)("div",{style:{marginTop:"8px",padding:"8px 12px",background:"rgba(34,197,94,0.06)",border:"1px solid rgba(34,197,94,0.2)",borderRadius:"8px",color:"#4ade80",fontSize:"12px",fontWeight:700},children:C}),w&&(0,n.jsx)("div",{style:{marginTop:"8px",padding:"8px 12px",background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.2)",borderRadius:"8px",color:"#fbbf24",fontSize:"12px",fontWeight:700},children:w}),(0,n.jsxs)("div",{style:{marginTop:"20px",display:"flex",flexDirection:"column",gap:"8px"},children:[(0,n.jsx)("button",{onClick:()=>e.push("/photos?id="+k),style:{width:"100%",padding:"14px",borderRadius:"10px",background:"#8b5cf6",color:"#fff",fontWeight:800,fontSize:"14px",border:"none"},children:"Add Completion Photos"}),(0,n.jsx)("button",{onClick:()=>ee(),style:{width:"100%",padding:"16px",borderRadius:"10px",background:"#3b82f6",color:"#fff",fontWeight:800,fontSize:"16px",border:"none"},children:"Scan Next VIN"}),(0,n.jsx)("button",{onClick:()=>e.push("/home"),style:{width:"100%",padding:"10px",borderRadius:"10px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"Home"})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"Vehicle Identified"}),(0,n.jsxs)("div",{style:{background:"linear-gradient(135deg, #1a2a3f, #1e3350)",border:"1px solid #2a4a6f",borderRadius:"14px",padding:"18px",marginBottom:"12px"},children:[(0,n.jsx)("div",{style:{fontSize:"10px",color:"#4a5f78",fontWeight:600,letterSpacing:"1px",textTransform:"uppercase"},children:"VIN"}),(0,n.jsx)("div",{style:{fontSize:"13px",fontFamily:"monospace",color:"#93c5fd",fontWeight:700,letterSpacing:"1.5px",marginTop:"2px",marginBottom:"10px"},children:v.vin}),(0,n.jsx)("div",{style:{fontSize:"20px",fontWeight:800},children:et||"Unknown"}),v.vehicle.bodyClass&&(0,n.jsx)("div",{style:{fontSize:"13px",color:"#6b7a8d",marginTop:"2px"},children:v.vehicle.bodyClass})]}),u&&(0,n.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"10px 12px",marginBottom:"12px",fontSize:"12px"},children:[(0,n.jsx)("span",{style:{color:"#4a5f78"},children:"Recording as "}),(0,n.jsx)("span",{style:{fontWeight:700,color:"#60a5fa"},children:u.part_number}),(0,n.jsxs)("span",{style:{color:"#4a5f78"},children:[" - ",u.end_customer]})]}),g&&(0,n.jsx)("div",{style:{marginTop:"8px",padding:"8px 12px",background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:"8px",color:"#f87171",fontSize:"12px",marginBottom:"12px"},children:g}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,n.jsx)("button",{onClick:$,style:{width:"100%",padding:"16px",borderRadius:"10px",background:"#22c55e",color:"#fff",fontSize:"16px",fontWeight:800,border:"none"},children:"Confirm - Record Vehicle"}),(0,n.jsx)("button",{onClick:()=>{y(null),x("")},style:{width:"100%",padding:"10px",borderRadius:"10px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"Scan Different VIN"})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"12px"},children:"Scan VIN"}),u&&(0,n.jsxs)("div",{style:{background:"#141e2b",border:"1px solid #1e2d3d",borderRadius:"10px",padding:"10px 12px",marginBottom:"12px"},children:[(0,n.jsxs)("div",{style:{fontWeight:800,fontSize:"14px"},children:[u.part_number," - ",u.end_customer]}),(0,n.jsxs)("div",{style:{fontSize:"11px",color:"#4a5f78",marginTop:"1px"},children:[u.graphic_package," | ",u.vehicle_type]})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:"4px",marginBottom:"12px",background:"#141e2b",borderRadius:"8px",padding:"3px"},children:[(0,n.jsx)("button",{onClick:()=>{W("camera"),setTimeout(function(){K()},300)},style:{flex:1,padding:"8px",borderRadius:"6px",fontSize:"12px",fontWeight:700,background:"camera"===R?"rgba(59,130,246,0.15)":"transparent",border:"none",color:"camera"===R?"#60a5fa":"#4a5f78"},children:"Camera"}),(0,n.jsx)("button",{onClick:Z,style:{flex:1,padding:"8px",borderRadius:"6px",fontSize:"12px",fontWeight:700,background:"text"===R?"rgba(59,130,246,0.15)":"transparent",border:"none",color:"text"===R?"#60a5fa":"#4a5f78"},children:"Type / Scanner"})]}),"camera"===R?(0,n.jsx)("div",{children:B?(0,n.jsxs)("div",{style:{padding:"20px",textAlign:"center",background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:"10px"},children:[(0,n.jsx)("div",{style:{color:"#f87171",fontSize:"13px",marginBottom:"12px"},children:B}),(0,n.jsx)("button",{onClick:Z,style:{padding:"10px 20px",borderRadius:"8px",background:"#3b82f6",color:"#fff",fontWeight:700,fontSize:"13px",border:"none"},children:"Switch to Text Input"})]}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{position:"relative",borderRadius:"12px",overflow:"hidden",background:"#000",height:"300px",marginBottom:"8px"},children:[(0,n.jsx)("video",{ref:O,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,n.jsx)("div",{style:{position:"absolute",top:"50%",left:"3%",right:"3%",height:"70px",marginTop:"-35px",border:"3px solid rgba(59,130,246,0.8)",borderRadius:"8px",pointerEvents:"none",boxShadow:"0 0 20px rgba(59,130,246,0.3)"}}),(0,n.jsx)("div",{style:{position:"absolute",bottom:"0",left:"0",right:"0",padding:"10px",background:"rgba(0,0,0,0.7)"},children:D?(0,n.jsxs)("div",{style:{textAlign:"center"},children:[(0,n.jsx)("div",{style:{fontSize:"13px",color:"#fff",fontWeight:700},children:"Hold 4-8 in from barcode"}),M?(0,n.jsxs)("div",{style:{fontSize:"13px",color:"#fbbf24",marginTop:"3px",fontFamily:"monospace",fontWeight:800},children:["FOUND: ",M," (",M.length," chars)"]}):(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#9ca3af",marginTop:"3px"},children:["Scanning... ",E," frames"]})]}):(0,n.jsx)("div",{style:{textAlign:"center",fontSize:"13px",color:"#9ca3af"},children:"Starting camera..."})})]}),(0,n.jsx)("canvas",{ref:V,style:{display:"none"}})]})}):(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{ref:I,type:"text",value:f,onChange:e=>x(e.target.value.toUpperCase().replace(/[^A-HJ-NPR-Z0-9]/gi,"").slice(0,17)),placeholder:"Enter or scan 17-char VIN",maxLength:17,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #1e2d3d",background:"#141e2b",color:"#e8ecf1",fontSize:"18px",letterSpacing:"2px",fontWeight:700,textAlign:"center"},onKeyDown:e=>{"Enter"===e.key&&17===f.length&&Q()}}),(0,n.jsxs)("div",{style:{textAlign:"center",marginTop:"4px",fontSize:"13px",fontWeight:600,color:17===f.length?"#22c55e":"#4a5f78"},children:[f.length,"/17 ",17===f.length?"OK":""]})]}),g&&(0,n.jsx)("div",{style:{marginTop:"8px",padding:"8px 12px",background:"rgba(239,68,68,0.06)",border:"1px solid rgba(239,68,68,0.2)",borderRadius:"8px",color:"#f87171",fontSize:"12px"},children:g}),"text"===R&&(0,n.jsx)("button",{onClick:Q,disabled:17!==f.length,style:{width:"100%",padding:"16px",borderRadius:"10px",marginTop:"14px",background:17===f.length?"#3b82f6":"#1e2d3d",color:"#fff",fontSize:"16px",fontWeight:800,opacity:17===f.length?1:.4,border:"none"},children:"Decode VIN"}),(0,n.jsx)("button",{onClick:()=>e.push("/home"),style:{width:"100%",padding:"10px",borderRadius:"10px",marginTop:"8px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"Back"})]})}},7775:function(e,t,r){"use strict";r.d(t,{q:function(){return l},w:function(){return s}});var n=r(7437),i=r(2265),a=r(4754),o=r(2582);let d=(0,i.createContext)({});function s(e){let{children:t}=e,{user:r}=(0,o.a)(),s=(0,a.e)(),[l,c]=(0,i.useState)("out"),[u,p]=(0,i.useState)(null),[f,x]=(0,i.useState)(null),[g,h]=(0,i.useState)([]),[m,b]=(0,i.useState)(0),[v,y]=(0,i.useState)(null),[_,S]=(0,i.useState)(null),[k,T]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(!r){T(!1);return}(async()=>{try{let{data:e}=await s.from("time_entries").select("*").eq("user_id",r.id).is("clock_out",null).order("clock_in",{ascending:!1}).limit(1).maybeSingle();if(e){y(e),p(e.clock_in);let{data:t}=await s.from("time_breaks").select("*").eq("time_entry_id",e.id).order("break_start",{ascending:!0}),r=t||[];h(r);let n=r.find(e=>!e.break_end);n?(x(n.break_start),c("break")):c("in")}}catch(e){console.error("AppProvider load error:",e)}T(!1)})()},[r]),(0,i.useEffect)(()=>{if("out"===l||!u)return;let e=setInterval(()=>{let e=Date.now()-new Date(u).getTime();g.forEach(t=>{t.break_end&&(e-=new Date(t.break_end).getTime()-new Date(t.break_start).getTime())}),"break"===l&&f&&(e-=Date.now()-new Date(f).getTime()),b(Math.max(0,e))},1e3);return()=>clearInterval(e)},[l,u,f,g]);let w=(0,i.useCallback)(async()=>{if(!r)return;let e=new Date().toISOString(),{data:t,error:n}=await s.from("time_entries").insert({user_id:r.id,clock_in:e,status:"clocked_in"}).select().single();t&&!n&&(y(t),p(e),h([]),c("in"),b(0))},[r,s]),j=(0,i.useCallback)(async()=>{if(!v)return;let e=new Date().toISOString(),{data:t}=await s.from("time_breaks").insert({time_entry_id:v.id,break_start:e}).select().single();await s.from("time_entries").update({status:"on_break"}).eq("id",v.id),t&&(h(e=>[...e,t]),x(e),c("break"))},[v,s]),C=(0,i.useCallback)(async()=>{if(!v||!f)return;let e=new Date().toISOString(),t=g.find(e=>!e.break_end);t&&(await s.from("time_breaks").update({break_end:e}).eq("id",t.id),h(r=>r.map(r=>r.id===t.id?{...r,break_end:e}:r))),await s.from("time_entries").update({status:"clocked_in"}).eq("id",v.id),x(null),c("in")},[v,f,g,s]),F=(0,i.useCallback)(async()=>{if(!v||!u)return;let e=new Date,t=e.toISOString(),r=g.find(e=>!e.break_end);r&&await s.from("time_breaks").update({break_end:t}).eq("id",r.id);let n=e.getTime()-new Date(u).getTime();g.map(e=>({...e,break_end:e.break_end||t})).forEach(e=>{n-=new Date(e.break_end).getTime()-new Date(e.break_start).getTime()}),await s.from("time_entries").update({clock_out:t,status:"clocked_out",total_ms:Math.max(0,n)}).eq("id",v.id),c("out"),p(null),x(null),h([]),b(0),y(null)},[v,u,g,s]);return(0,n.jsx)(d.Provider,{value:{clockStatus:l,clockInTime:u,breakStartTime:f,currentBreaks:g,elapsed:m,activeTimeEntry:v,doClockIn:w,doStartBreak:j,doEndBreak:C,doClockOut:F,activePart:_,setActivePart:S,appLoading:k},children:t})}let l=()=>(0,i.useContext)(d)},2582:function(e,t,r){"use strict";r.d(t,{H:function(){return d},a:function(){return s}});var n=r(7437),i=r(2265),a=r(4754);let o=(0,i.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function d(e){let{children:t}=e,[r,d]=(0,i.useState)(null),[s,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(!0),p=(0,a.e)();(0,i.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:r}}=await p.auth.getSession(),n=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;if(e)return;if(d(n),n){let{data:t}=await p.from("profiles").select("*").eq("id",n.id).maybeSingle();e||l(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||u(!1)})();let{data:{subscription:t}}=p.auth.onAuthStateChange(async(t,r)=>{try{var n;if(e)return;if(d(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),null==r?void 0:r.user){let{data:t}=await p.from("profiles").select("*").eq("id",r.user.id).maybeSingle();e||l(t)}else l(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||u(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let f=async()=>{await p.auth.signOut(),d(null),l(null)};return(0,n.jsx)(o.Provider,{value:{user:r,profile:s,isAdmin:(null==s?void 0:s.role)==="admin",loading:c,signOut:f},children:t})}let s=()=>(0,i.useContext)(o)},4754:function(e,t,r){"use strict";r.d(t,{e:function(){return a}});var n=r(4033),i=r(257);function a(){return(0,n.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=5065)}),_N_E=e.O()}]);