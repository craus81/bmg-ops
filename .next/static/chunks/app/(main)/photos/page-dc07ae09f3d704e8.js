(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[623],{3594:function(e,t,r){Promise.resolve().then(r.bind(r,9116))},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},9116:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(7437),i=r(2265),o=r(9376),l=r(4754),a=r(2582);function s(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)().get("id"),{user:r}=(0,a.a)(),s=(0,l.e)(),[u,d]=(0,i.useState)([]),[c,p]=(0,i.useState)(null),[f,h]=(0,i.useState)(!1),[g,x]=(0,i.useState)(!0),m=(0,i.useRef)(null);(0,i.useEffect)(()=>{t&&(async()=>{let{data:e}=await s.from("scanned_vehicles").select("*").eq("id",t).single();p(e);let{data:r}=await s.from("vehicle_photos").select("*").eq("vehicle_id",t).order("taken_at",{ascending:!0});d(await Promise.all((r||[]).map(async e=>{let{data:t}=s.storage.from("photos").getPublicUrl(e.storage_path);return{...e,url:t.publicUrl}}))),x(!1)})()},[t]);let v=async e=>{if(!t||!r)return;h(!0);let n=e.name.split(".").pop()||"jpg",i="".concat(t,"/").concat(Date.now(),".").concat(n),{error:o}=await s.storage.from("photos").upload(i,e,{contentType:e.type});if(o){alert("Upload failed: "+o.message),h(!1);return}let{data:l}=await s.from("vehicle_photos").insert({vehicle_id:t,storage_path:i,photo_type:"completion",taken_by:r.id}).select().single();if(l){let{data:e}=s.storage.from("photos").getPublicUrl(i);d(t=>[...t,{...l,url:e.publicUrl}])}h(!1)};if(!t)return(0,n.jsx)("div",{style:{color:"#f87171",padding:"20px"},children:"No vehicle ID"});if(g)return(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#4a5f78"},children:"Loading..."});let b=c?[c.vehicle_year,c.vehicle_make,c.vehicle_model].filter(Boolean).join(" "):"Vehicle";return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:"11px",fontWeight:700,color:"#4a5f78",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"6px"},children:"Completion Photos"}),(0,n.jsx)("div",{style:{fontWeight:700,fontSize:"15px",marginBottom:"4px"},children:b}),(null==c?void 0:c.vin)&&(0,n.jsx)("div",{style:{fontSize:"11px",fontFamily:"monospace",color:"#4a5f78",marginBottom:"16px"},children:c.vin}),(0,n.jsx)("input",{ref:m,type:"file",accept:"image/*",capture:"environment",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&v(r),e.target.value=""},style:{display:"none"}}),(0,n.jsxs)("div",{style:{display:"flex",gap:"8px",marginBottom:"16px"},children:[(0,n.jsx)("button",{onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},disabled:f,style:{flex:1,padding:"14px",borderRadius:"10px",background:"#3b82f6",color:"#fff",fontWeight:700,fontSize:"14px",opacity:f?.5:1},children:f?"Uploading...":"\uD83D\uDCF8 Take Photo"}),(0,n.jsx)("button",{onClick:()=>{m.current&&(m.current.removeAttribute("capture"),m.current.click(),m.current.setAttribute("capture","environment"))},disabled:f,style:{padding:"14px 18px",borderRadius:"10px",border:"1px solid #1e2d3d",background:"#141e2b",color:"#6b7a8d",fontWeight:700,fontSize:"14px"},children:"\uD83D\uDCC1"})]}),0===u.length&&(0,n.jsxs)("div",{style:{textAlign:"center",padding:"28px 0",color:"#4a5f78"},children:[(0,n.jsx)("div",{style:{fontSize:"36px",marginBottom:"6px",opacity:.4},children:"\uD83D\uDCF7"}),(0,n.jsx)("div",{style:{fontWeight:600,fontSize:"13px"},children:"No photos yet — tap to add"})]}),(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4px"},children:u.map(e=>(0,n.jsx)("div",{style:{position:"relative",paddingTop:"100%",borderRadius:"8px",overflow:"hidden",background:"#141e2b"},children:e.url&&(0,n.jsx)("img",{src:e.url,alt:"Vehicle photo",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}})},e.id))}),(0,n.jsxs)("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"8px"},children:[(0,n.jsx)("button",{onClick:()=>e.push("/scan"),style:{width:"100%",padding:"12px",borderRadius:"10px",background:"rgba(59,130,246,0.08)",border:"1px solid rgba(59,130,246,0.25)",color:"#60a5fa",fontWeight:700,fontSize:"13px"},children:"\uD83D\uDCF7 Scan Next VIN"}),(0,n.jsx)("button",{onClick:()=>e.back(),style:{width:"100%",padding:"10px",borderRadius:"10px",border:"1px solid #1e2d3d",background:"transparent",color:"#6b7a8d",fontSize:"13px",fontWeight:700},children:"← Back"})]})]})}},2582:function(e,t,r){"use strict";r.d(t,{H:function(){return a},a:function(){return s}});var n=r(7437),i=r(2265),o=r(4754);let l=(0,i.createContext)({user:null,profile:null,isAdmin:!1,loading:!0,signOut:async()=>{}});function a(e){let{children:t}=e,[r,a]=(0,i.useState)(null),[s,u]=(0,i.useState)(null),[d,c]=(0,i.useState)(!0),p=(0,o.e)();(0,i.useEffect)(()=>{let e=!1;(async()=>{try{var t;let{data:{session:r}}=await p.auth.getSession(),n=null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null;if(e)return;if(a(n),n){let{data:t}=await p.from("profiles").select("*").eq("id",n.id).maybeSingle();e||u(t)}}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth init error:",e)}e||c(!1)})();let{data:{subscription:t}}=p.auth.onAuthStateChange(async(t,r)=>{try{var n;if(e)return;if(a(null!==(n=null==r?void 0:r.user)&&void 0!==n?n:null),null==r?void 0:r.user){let{data:t}=await p.from("profiles").select("*").eq("id",r.user.id).maybeSingle();e||u(t)}else u(null)}catch(e){if((null==e?void 0:e.name)==="AbortError")return;console.error("Auth state error:",e)}e||c(!1)});return()=>{e=!0,t.unsubscribe()}},[]);let f=async()=>{await p.auth.signOut(),a(null),u(null)};return(0,n.jsx)(l.Provider,{value:{user:r,profile:s,isAdmin:(null==s?void 0:s.role)==="admin",loading:d,signOut:f},children:t})}let s=()=>(0,i.useContext)(l)},4754:function(e,t,r){"use strict";r.d(t,{e:function(){return o}});var n=r(4033),i=r(257);function o(){return(0,n.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}}},function(e){e.O(0,[368,971,117,744],function(){return e(e.s=3594)}),_N_E=e.O()}]);